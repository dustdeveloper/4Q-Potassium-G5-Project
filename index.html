<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="assets/css/index.css">

        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=M+PLUS+1+Code">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans">

        <script src="scripts/libraries/GSAP/gsap.min.js"></script>
        <script src="scripts/libraries/GSAP/TextPlugin.min.js"></script>
        <script src="scripts/libraries/storage.js"></script>

        <script src="scripts/libraries/signal.js"></script>
        <script src="scripts/libraries/sound.js"></script>
    </head>
    <body>
        <video id="background-vid" src="assets/video/placeholder.mp4" muted autoplay loop></video>

        <div class="center-zone">
            <div class="navigation">
                <h1 id="nav-text">CC_</h1>
                <button id="nav-button">Play the Game</button>
            </div>

            <h1 class="main-text" id="mn-plug-in">[ REDACTED ]</h1>
            <hr id="title-div">
            <h1 class="main-text" id="sub-main-text">&nbsp;Welcome to Crashcode!</h1>

            <div class="description-container">
                <div id="left-container">
                    <h1>ABOUT THIS GAME</h1>
                    &nbsp;&nbsp;Developed by [GROUP 5], Crashcode is a <strong>2-player management game</strong> where both coordinate in a spiral of observation and reaction.<br><br>
                    &nbsp;&nbsp;Skills like teamwork and coordination play a part as both of you maintain a machine capable of thought.&nbsp;&nbsp;
                </div>
                <div id="right-container">
                    <h1>SUMMARY</h1>
                    <div>
                        &nbsp;&nbsp;You both are instructor and trainee, sent to a key base facility north of headquarters. Your mission is to maintain the computational systems, nicknamed "the machines that think".<br><br>
                        &nbsp;&nbsp; It's an otherwise normal, and possibly peaceful job, given that these systems are old, but a recent breach far south of the base attempts to jeopradize everything. 
                    </div>
                </div>
            </div>
        </div>

        <!-- LOADER ZONE -- SEMANTIC ZONE -->

        <section class="loader" id="loader-top">
            <section class="central central-top">
                <strong id="epilepsy">EPILEPSY WARNING</strong><br> This website contains strobing visuals that may trigger epileptic seizures. Please exit the website if you have these conditions.
            </section>
        </section>
        <section class="loader" id="loader-bottom">
            <section class="central central-bottom">
                <button onclick="trigger()">> Continue</button>
            </section>
        </section>
        <section id="filler-wall"></section>

        <script>
            gsap.registerPlugin(TextPlugin);

            let triggered = false;
            let volume = {v:0}

            let main_table = [
                "Test your critical thinking.",
                "The time is ticking.",
                "Test your coordination.",
            ]

            let bg_music = new Sound("assets/audio/Utopian_Dream.mp3", 0);
            bg_music.sound_is_playable.connect("playableEvent", event => {
                console.log("sound is now playable!")
            })

            bg_music.playing.connect("playing", event => {
                console.log("sound is playing!")
            })

            function getRandom() {
                const randomIndex = Math.floor(Math.random() * main_table.length);
                return main_table[randomIndex];
            };

            function trigger() {
                if (triggered) { return };
                triggered = true;

                //if (!Local.get("hasAccepted")) {
                //    Local.set("hasAccepted", true);
                //}

                let loader_timeline = gsap.timeline();

                loader_timeline
                    .to(".central-top", {borderColor: "rgba(255,0,0,0)", duration: 3, ease: "power1.inOut"}, 0)
                    .to(".central", {text: "Have a nice stay.", duration: 1, ease: "power1.inOut"}, 0)
                    .to(".central", {color: "rgba(255,0,0,0)", duration: 2.5, ease: "power1.inOut"}, 0)
                    .to(volume, {v:0.1, duration: 2, ease: "power1.in"}, 0)

                    .to("#loader-top", {y: "-100%", duration: 2, ease: "power1.out"}, 3.5)
                    .to("#loader-bottom", {y: "100%", duration: 2, ease: "power1.out"}, 3.5)
                    .to("#filler-wall", {opacity: "0", duration: 2, ease: "power1.inOut"}, 3.5)

                    .to("#filler-wall", {x: "300%", duration: 2, ease: "power1.inOut"}, 5.5)
                    .call(() => {
                        document.getElementById("loader-top").remove();
                        document.getElementById("loader-bottom").remove();
                        document.getElementById("filler-wall").remove();
                    }, null, 5.5)
                    .to("html, body", {overflow: "auto", duration: 2, ease: "power1.inOut"}, 5.5)
                    .to("#mn-plug-in", {text: getRandom(), duration: 1, ease: "power1.outIn"}, 5.5)
            
                bg_music.wait_to_play();
            }

            // if (Local.get("hasAccepted")) {trigger()} breaks the sound system

            setInterval(() => {
                bg_music.set_volume(volume.v) 
            }, .1)
            
        </script> 
        <!-- LOADER ZONE END -->

    </body>
</html>